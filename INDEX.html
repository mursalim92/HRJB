async function loadData() {
    const SPREADSHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSuJPtEwzwo9O3MjCKYYQBbz_rGkod8Bjm4G13B4BwhD3RlmdP2WwBXK9Smy0mrlfdNvJtDHFCi-P9Y/pub?output=csv";
    const nik = document.getElementById("nikInput").value.trim();
    const resultDiv = document.getElementById("resultContainer");

    // Tampilkan loading
    resultDiv.innerHTML = `<div class="loading"><div class="spinner"></div></div>`;

    try {
        const response = await fetch(SPREADSHEET_URL);
        if (!response.ok) throw new Error("Gagal mengambil data");
        
        const csvData = await response.text();
        const rows = csvData.split("\n");
        const header = rows[0].split(",");

        // Debug: Lihat struktur header
        console.log("Header Kolom:", header);

        // Cari index kolom AH (tgl 11) sampai BB (tgl 10)
        const startCol = header.findIndex(col => col.trim() === "AH");
        if (startCol === -1) throw new Error("Kolom AH tidak ditemukan");

        const dateColumns = [];
        // 31 hari (11-31) + 10 hari (1-10) = 41 kolom
        for (let i = 0; i < 41; i++) {
            dateColumns.push(startCol + i);
        }

        // Cari data karyawan
        const karyawan = rows.find(row => {
            const rowData = row.split(",");
            return rowData[0].trim() === nik;
        });

        if (karyawan) {
            const data = karyawan.split(",");
            const nama = data[1] || '-';
            
            // Generate HTML untuk tabel absensi
            let tableHTML = `
                <table class="attendance-table">
                    <tr>
                        ${Array.from({length: 31}, (_, i) => `<th>Tgl ${i+11}</th>`).join('')}
                        ${Array.from({length: 10}, (_, i) => `<th>Tgl ${i+1}</th>`).join('')}
                    </tr>
                    <tr>
                        ${dateColumns.map(col => {
                            const status = (data[col] || '-').trim();
                            let className = '';
                            if (status.includes('Hadir')) className = 'status-hadir';
                            else if (status.includes('Izin')) className = 'status-izin';
                            else if (status.includes('Alpha')) className = 'status-alpha';
                            return `<td class="${className}">${status}</td>`;
                        }).join('')}
                    </tr>
                </table>
            `;

            resultDiv.innerHTML = `
                <div class="employee-card">
                    <h2>${nama}</h2>
                    <div style="overflow-x:auto">${tableHTML}</div>
                </div>
            `;
        } else {
            throw new Error("Data karyawan tidak ditemukan");
        }
    } catch (error) {
        resultDiv.innerHTML = `
            <div class="error-message">
                <i class="fas fa-exclamation-circle"></i>
                <p>${error.message}</p>
            </div>
        `;
        console.error("Error:", error);
    }
}

// Fungsi untuk menangani error
function showError(message) {
    const resultDiv = document.getElementById("resultContainer");
    resultDiv.innerHTML = `
        <div class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            <p>${message}</p>
        </div>
    `;
}
