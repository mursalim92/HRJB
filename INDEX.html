<script>
  async function loadDataFromSheets() {
    const SPREADSHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSuJPtEwzwo9O3MjCKYYQBbz_rGkod8Bjm4G13B4BwhD3RlmdP2WwBXK9Smy0mrlfdNvJtDHFCi-P9Y/pub?gid=0&single=true&output=csv";
    const nik = document.getElementById("nikInput").value;
    const resultDiv = document.getElementById("result");

    try {
      // Ambil data dari Google Sheets
      const response = await fetch(SPREADSHEET_URL);
      const csvData = await response.text();
      const rows = csvData.split("\n").slice(1); // Skip header

      // Cari data berdasarkan NIK
      const karyawan = rows.find(row => row.split(",")[0].trim() === nik);

      if (karyawan) {
        const data = karyawan.split(",");
        const nama = data[1];
        const jabatan = data[2];
        const dept = data[3];
        
        // Generate tabel (sesuaikan dengan struktur spreadsheet Anda)
        let tableHTML = `
          <h2>Data Karyawan</h2>
          <table>
            <tr>
              <th>NIK</th>
              <th>Nama</th>
              <th>Jabatan</th>
              <th>Departemen</th>
              ${Array.from({length: 30}, (_, i) => `<th>Tgl ${i+11 > 31 ? i-20 : i+11}</th>`).join('')}
            </tr>
            <tr>
              <td>${nik}</td>
              <td>${nama}</td>
              <td>${jabatan}</td>
              <td>${dept}</td>
              ${data.slice(4).map(status => {
                let className = '';
                if (status.includes("Hadir")) className = "status-hadir";
                else if (status.includes("Izin")) className = "status-izin";
                else if (status.includes("Alpha")) className = "status-alpha";
                return `<td class="${className}">${status}</td>`;
              }).join('')}
            </tr>
          </table>
        `;

        resultDiv.innerHTML = tableHTML;
      } else {
        resultDiv.innerHTML = '<p style="color:red">Data tidak ditemukan</p>';
      }
    } catch (error) {
      resultDiv.innerHTML = `<p style="color:red">Error: ${error.message}</p>`;
    }
  }

  // Update fungsi cariKaryawan
  function cariKaryawan() {
    loadDataFromSheets();
  }
</script>
