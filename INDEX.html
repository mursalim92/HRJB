<!DOCTYPE html>
<html>
<head>
  <title>Absensi Karyawan</title>
  <style>
    table, th, td { border: 1px solid black; padding: 5px; }
    .hadir { color: green; }
    .izin { color: orange; }
    .alpha { color: red; }
  </style>
</head>
<body>
  <input type="text" id="nikInput" placeholder="Masukkan NIK">
  <button onclick="loadData()">Cari</button>
  <div id="result"></div>

  <script>
    async function loadData() {
      const SPREADSHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSuJPtEwzwo9O3MjCKYYQBbz_rGkod8Bjm4G13B4BwhD3RlmdP2WwBXK9Smy0mrlfdNvJtDHFCi-P9Y/pub?output=csv";
      const nik = document.getElementById("nikInput").value;
      const resultDiv = document.getElementById("result");

      try {
        console.log("Mengambil data..."); // Debug 1
        const response = await fetch(SPREADSHEET_URL);
        const csvData = await response.text();
        console.log("Data mentah:", csvData); // Debug 2

        const rows = csvData.split("\n");
        const header = rows[0].split(",");
        const karyawan = rows.find(row => row.split(",")[0] === nik);

        if (karyawan) {
          const data = karyawan.split(",");
          let tableHTML = `
            <table>
              <tr><th>NIK</th><th>Nama</th><th>Jabatan</th><th>Departemen</th></tr>
              <tr>
                <td>${data[0]}</td>
                <td>${data[1]}</td>
                <td>${data[2]}</td>
                <td>${data[3]}</td>
              </tr>
              <tr><th colspan="4">Absensi (11-10)</th></tr>
              <tr>
          `;

          // Loop untuk tanggal 11-31 dan 1-10
          for (let i = 4; i < header.length; i++) {
            const status = data[i].trim().toLowerCase();
            tableHTML += `<td class="${status}">${header[i]}: ${data[i]}</td>`;
          }

          tableHTML += `</tr></table>`;
          resultDiv.innerHTML = tableHTML;
        } else {
          resultDiv.innerHTML = "Data tidak ditemukan!";
        }
      } catch (error) {
        console.error("Error:", error); // Debug 3
        resultDiv.innerHTML = "Gagal memuat data. Cek console untuk detail.";
      }
    }
  </script>
</body>
</html>
